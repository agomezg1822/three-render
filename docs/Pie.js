import{Group}from"three";import{GLTFLoader}from"three/examples/jsm/loaders/GLTFLoader.js";import MODEL from"./Pie.glb";import{utils,read}from"xlsx";export default class Pie extends Group{constructor(){const e=new GLTFLoader;super(),this.name="pie",e.load(MODEL,(async e=>{this.add(e.scene),this.scale.set(10,10,10),this.position.set(0,0,0);const{valoresYIzquierdoExcel:t,valoresYDerechoExcel:o}=await this.leerExcel();for(let a=1;a<100;a++){const s=a.toString().padStart(2,"0"),r=e.scene.getObjectByName(`I${s}`),c=e.scene.getObjectByName(`D${s}`);r.scale.y=t[a-1],c.scale.y=o[a-1],this.asignacionColor(r,t[a-1]),this.asignacionColor(c,o[a-1])}})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("fileInput"),t=document.getElementById("sheetSelect");e.addEventListener("change",(async e=>{const o=await this.obtenerNombresHojas(e);t.innerHTML="",o.forEach((e=>{const o=document.createElement("option");o.value=e,o.textContent=e,t.appendChild(o)}))})),t.addEventListener("change",(async()=>{const e=t.value,{valoresYIzquierdoExcel:o,valoresYDerechoExcel:a}=await this.obtenerDatosHoja(e);this.actualizarModelo(o,a)}))}))}async leerExcel(){const e=await fetch("datos.xlsx"),t=await e.arrayBuffer(),o=read(t),a=o.SheetNames[0],s=o.Sheets[a];return{valoresYIzquierdoExcel:utils.sheet_to_json(s,{range:{s:{c:1,r:2},e:{c:1,r:101}}}).map((e=>e.Data)),valoresYDerechoExcel:utils.sheet_to_json(s,{range:{s:{c:2,r:2},e:{c:2,r:101}}}).map((e=>e.Data))}}async obtenerNombresHojas(e){const t=e.target.files[0],o=await t.arrayBuffer();return read(o).SheetNames}async obtenerDatosHoja(e){const t=document.getElementById("fileInput").files[0];if(t){const o=await t.arrayBuffer(),a=read(o).Sheets[e],s={s:{c:1,r:2},e:{c:1,r:101}},r={s:{c:2,r:2},e:{c:2,r:101}};return{valoresYIzquierdoExcel:utils.sheet_to_json(a,{range:s}).map((e=>e.Data)),valoresYDerechoExcel:utils.sheet_to_json(a,{range:r}).map((e=>e.Data))}}return console.error("No se ha seleccionado ning√∫n archivo."),null}actualizarModelo(e,t){for(let o=1;o<100;o++){const a=o.toString().padStart(2,"0"),s=this.getObjectByName(`I${a}`),r=this.getObjectByName(`D${a}`);s.scale.y=e[o-1],r.scale.y=t[o-1],this.asignacionColor(s,e[o-1]),this.asignacionColor(r,t[o-1])}}asignacionColor(e,t){const o=e.material.clone();t>-1&&t<=10?o.color.setHex(7880039):t>10&&t<=20?o.color.setHex(6773119):t>20&&t<=30?o.color.setHex(5862293):t>30&&t<=40?o.color.setHex(4169402):t>40&&t<=50?o.color.setHex(6000009):t>50&&t<=60?o.color.setHex(7308136):t>60&&t<=70?o.color.setHex(9204278):t>70&&t<=80?o.color.setHex(11296258):t>80&&t<=90?o.color.setHex(11883537):t>90&&t<=100?o.color.setHex(12536352):t>100&&t<=200?o.color.setHex(13384247):o.color.setHex(16777215),e.material=o}}