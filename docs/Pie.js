import{Group}from"three";import{GLTFLoader}from"three/examples/jsm/loaders/GLTFLoader.js";import MODEL from"./Pie.glb";import{utils,read}from"xlsx";export default class Pie extends Group{constructor(){const e=new GLTFLoader;super(),this.name="pie",e.load(MODEL,(async e=>{this.add(e.scene),this.scale.set(10,10,10),this.position.set(0,0,0);const{valoresYIzquierdoExcel:o,valoresYDerechoExcel:t}=await this.leerExcel();for(let r=1;r<100;r++){const a=r.toString().padStart(2,"0"),s=e.scene.getObjectByName(`I${a}`),l=e.scene.getObjectByName(`D${a}`);s.scale.y=o[r-1],l.scale.y=t[r-1],this.asignacionColor(s,o[r-1]),this.asignacionColor(l,t[r-1])}})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("fileInput"),o=document.getElementById("sheetSelect");e.addEventListener("change",(async e=>{const t=await this.obtenerNombresHojas(e);o.innerHTML="",t.forEach((e=>{const t=document.createElement("option");t.value=e,t.textContent=e,o.appendChild(t)}))})),o.addEventListener("change",(async()=>{const e=o.value,{valoresYIzquierdoExcel:t,valoresYDerechoExcel:r}=await this.obtenerDatosHoja(e);this.actualizarModelo(t,r)}))}))}async leerExcel(){const e=await fetch("datos.xlsx"),o=await e.arrayBuffer(),t=read(o),r=t.SheetNames[0],a=t.Sheets[r];return{valoresYIzquierdoExcel:utils.sheet_to_json(a,{range:{s:{c:1,r:2},e:{c:1,r:101}}}).map((e=>e.Data)),valoresYDerechoExcel:utils.sheet_to_json(a,{range:{s:{c:2,r:2},e:{c:2,r:101}}}).map((e=>e.Data))}}async obtenerNombresHojas(e){const o=e.target.files[0],t=await o.arrayBuffer();return read(t).SheetNames}async obtenerDatosHoja(e){const o=document.getElementById("fileInput").files[0];if(o){const t=await o.arrayBuffer(),r=read(t).Sheets[e],a={s:{c:1,r:2},e:{c:1,r:101}},s={s:{c:2,r:2},e:{c:2,r:101}};return{valoresYIzquierdoExcel:utils.sheet_to_json(r,{range:a}).map((e=>e.Data)),valoresYDerechoExcel:utils.sheet_to_json(r,{range:s}).map((e=>e.Data))}}return console.error("No se ha seleccionado ning√∫n archivo."),null}actualizarModelo(e,o){for(let t=1;t<100;t++){const r=t.toString().padStart(2,"0"),a=this.getObjectByName(`I${r}`),s=this.getObjectByName(`D${r}`);a.scale.y=e[t-1],s.scale.y=o[t-1],this.asignacionColor(a,e[t-1]),this.asignacionColor(s,o[t-1])}}asignacionColor(e,o){const t=e.material.clone(),r=[{valor:-1,color:255},{valor:0,color:255},{valor:10,color:13311},{valor:20,color:26367},{valor:30,color:39423},{valor:40,color:52479},{valor:50,color:65535},{valor:60,color:16776960},{valor:70,color:16763904},{valor:80,color:16750848},{valor:90,color:16737792},{valor:100,color:16724736},{valor:2e3,color:16711680}];function a(e,o,t,r,a){const s=(a-e)/(o-e),l=t>>16&255,c=t>>8&255,n=255&t,i=r>>16&255,d=r>>8&255,h=255&r;return Math.round(l+s*(i-l))<<16|Math.round(c+s*(d-c))<<8|Math.round(n+s*(h-n))}for(let s=0;s<r.length-1;s++)if(o>=r[s].valor&&o<=r[s+1].valor){const l=a(r[s].valor,r[s+1].valor,r[s].color,r[s+1].color,o);return t.color.setHex(l),void(e.material=t)}t.color.setHex(16777215),e.material=t}}